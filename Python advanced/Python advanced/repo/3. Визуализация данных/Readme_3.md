Часть 3: визуализация данных

#Основы Matplotlib

Задание
Загрузите данные по ЕГЭ за последние годы
https://video.ittensive.com/python-advanced/data-9722-2019-10-14.utf.csv
выберите данные за 2018-2019 учебный год.
Выберите тип диаграммы для отображения результатов по административному округу Москвы, постройте выбранную диаграмму для количества школьников, написавших ЕГЭ на 220 баллов и выше.
Выберите тип диаграммы и постройте ее для районов Северо-Западного административного округа Москвы для количества школьников, написавших ЕГЭ на 220 баллов и выше.
Сколько школьников в Строгино, написавших ЕГЭ
Решение:
1)	подключаем нужные нам библиотеки
2)	вывод matplotlib прямо в окне браузера
3)	получаем данные по указанной ссылки, в качестве разделителя указываем ";"
4)	преобразуем данные по районам (чтобы устранить дубликаты и сделать подписи короче), удаляем из название слово "район", дополнительно назначаем район, категорией, чтобы группировка происходила быстрее
5)	преобразуем данные по округам, удаляем все слова кроме перового, данные по округам также преобразуем в категорию
6)	установим индекс по году, выполним сортировку, чтобы получить данные только за 2018-2019 год, затем сбросим индекс
7)	поскольку данных по округам и районам достаточно много, и вместе они образуют совокупность
8)	будем использовать круговую диаграмму, выведем две круговые диаграммы в одну строку
9)	берём холст 12 на 12
10)	добавляем на него первую область, 2 столбца, 1 строкой
11)	строим диаграмму распределения отличников по округам, добавим заголовок данных "ЕГЭ в Москве", размер шрифта 20 пикселей
12)	в качестве индекса, выбираем серию данных "AdmArea" (административные округа)
13)	теперь отсечём данные только отличников, сгруппируем данные по округам, выведем сумму на круговой диаграмме
14)	для второй диаграммы выберем все данные в Северо-западном округе, добавим область для вывода данных, 
15)	в эту область выведем заголовок: "ЕГЭ в Северо-Западном административном округе"
16)	получаем данные по Северо-Западному административному округу, сбрасываем индекс, затем устанавливаем индекс по серии данных "District", то есть по районам
17)	после этого отсечём только отличников, сгруппируем по серии данных "District",
18)	выполним операцию суммирования
19)	вычислим общее число отличников по районам
20)	построим круговую диаграмму по районам, округляем значения отличников, а затем приводим их к целому числу

#Визуализация зависимостей

Задание

Загрузите данные по итогам марафона
https://video.ittensive.com/python-advanced/marathon-data.csv
Приведите время половины и полной дистанции к секундам.
Найдите, данные каких серии данных коррелируют (используя диаграмму pairplot в Seaborn).
Найдите коэффициент корреляции этих серий данных, используя scipy.stats.pearsonr.
Постройте график jointplot для коррелирующих данных.
Решение: 
1)	подключаем нужные нам библиотеки
2)	создаём функцию для конвертации времени в общее количество часов, минут и секунд, функция будет принимать на вход строку, описывающую время и возвращать через генератор, перебирающий пары значений, число и его вес в секундах
3)	затем, мы возьмём сумму этих произведений чисел и их весов, и вернём из функции значение часов, минут и секунд получим, разделив исходную строку времени по двоеточию
4)	получаем нужные нам данные в качестве разделителя указываем запятую
5)	применяем функцию для конвертации времени, к сериям данных "split" и "final"
6)	построим парный график, чтобы посмотреть, какие данные с какими коррелируют
7)	для групп, или категорий используем пол спортсменов
8)	строим корреляционный график jointplot(), для серий данных "split" и "final", и найдём коэффициент корреляции Пирсона
9)	дополнительно выводим коэффициент Пирсона, по двум сериям данных отдельно

#Временные ряды

Задание

Используя данные индекса РТС за последние годы
https://video.ittensive.com/python-advanced/rts-index.csv
постройте отдельные графики закрытия (Close) индекса по дням за 2017, 2018, 2019 годы в единой оси X.
Добавьте на график экспоненциальное среднее за 20 дней для значения Max за 2017 год.
Найдите последнюю дату, когда экспоненциальное среднее максимального дневного значения (Max) в 2017 году было больше, чем соответствующее значение Close в 2019 году (это последнее пересечение графика за 2019 год и графика для среднего за 2017 год).
Решение:
1)	подключаем нужные нам библиотеки
2)	получаем необходимые данные
3)	преобразуем строковые значения в серии данных "Date", к типу данных "дата"
4)	указываем dayfirst=True, чтобы все даты корректно преобразовались из русского формата, в английский
5)	выполняем сортировку данных, от минимального к максимального
6)	в качестве индекса используем серию данных "Date"
7)	переиндексируем все данные, заполним пустые даты предыдущими значениями, это понадобиться нам для сравнения данных по годам, чтобы в каждый день года, у нас было хотя бы одно значение
8)	добавим ещё одну серию данных, "день года" для подписи по осям x
9)	назначаем название индекса, которое потерялось при переиндексации данных
10)	сортируем по индексу, чтобы развернуть данные в правильном хронологическом порядке
11)	для данных за 2019 год создадим отдельный набор, чтобы в последствии искать искомую, дату превышения, как пересечение его с набором за 2017 год
12)	аналогичным образом и создадим набор данных и для 2017 года, для него сразу возьмём экспоненциальное среднее, со сдвигом 20 от значения максимума 
13)	создаём наш холст, размером 12 на 8, добавляем на него 1 столбец, 1 строка, 1 подобласть
14)	наносим данные на область area, с названием "2019" цвет красный, толщина 3
15)	наносим обычные данные за 2017 год в виде оранжевой линии
16)	переопределяем индекс, и назначаем в качестве индекса серию данных "Close"
17)	а также за 2018 год, виде ещё одной линии
18)	добавляем легенду
19)	находим дату, когда показатели индекса РТС, превзошли показатели за 2017 год, фильтруем данные за 2019 год, когда "Close" (закрытие дня), было больше максимума, аналогичного дня за 2017 год  
20)	выставляем индекс по дате, отсортируем по индексу
21)	выведем первое значение, то есть последнюю дату, когда дневной максимум в 2017 году, был больше закрытия, в соответствующим дне 2019 года 

#Гео-данные и картограммы

Задание

Изучите набор данных по объектам культурного наследия России (в виде gz-архива):
https://video.ittensive.com/python-advanced/data-44-structure-4.csv.gz
и постройте фоновую картограмму по количеству объектов в каждом регионе России, используя гео-данные
https://video.ittensive.com/python-advanced/russia.json
Выведите для каждого региона количество объектов в нем.
Посчитайте число объектов культурного наследия в Татарстане.
Решение:
1)	загружаем файл локально, так как из его большого объёма, могут возникнуть сложности при работе, будем использовать только колонки "Объект" и "Регион"
2)	приводим регион к верхнему регистру, важно чтобы регистр "региона", в обоих наборах данных был одинаковый 
3)	выполняем группировку по региону, посчитаем число объектов по каждому региону, находим все расхождения, которые уже выведены в наборе нулевых значений, в результирующем объединённом наборе данных
4)	загружаем гео-данные
5)	приводим их к миркатеру
6)	Название регионов в геоданных приводим к верхнему регистру
7)	выполняем переманивание регионов в "гео-наборе", чтобы унифицировать их с основным набором данных
8)	осуществляем объединение наборов данных, (осинового и "гео"), слияние выполняем по региону, за исходный набор данных возьмём "гео", в него вольём данные по объектам, чтобы вывести
9)	отображаем эти данные на картограмме
10)	чтобы найти проблемы по регионам, какие названия у нас расходятся выведем все строки где поля объект, значит число объектов в регионе "null", то есть объединение корректно по этому региону не прошло (региона не было в исходном наборе)
11)	Создаём холст, добавляем туда область, наносим область на картограмму, будем использовать количество объектов культурного наследия для числовой градации
12)	обрезаем картограмму, убираем Чукотку, и всё что западнее Калининграда, задаём лимит по оси x, так как координаты указаны в десятках миллионов (1е7), поэтому нам нужен диапазон от 2 миллионов, до 20 миллионов
13)	дополнительно наносим аннотацию, в виде числа объектов в каждом регионе
14)	число объектов разместим в центре полигона, отвечающим за конкретный регион
15)	выводим число объектов для Алтайского Края